<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポケモン番号クイズ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        img {
            width: 200px;
            height: auto;
        }
    </style>
    <!-- SweetAlert2のCDNを追加 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <h1>ポケモン番号クイズ</h1>
    <div id="pokemonInfo">
        <h2 id="pokemonName"></h2>   <!-- ポケモンの名前 -->
        <img id="pokemonImage" src="" alt="ポケモン画像" width="200">
    </div>
    
    <div>
        <p>このポケモンの番号は？</p>
        <input type="number" id="userInput" placeholder="番号を入力">
        <button id="checkAnswer">チェック</button>
        <p id="resultMessage"></p>  <!-- 結果を表示する場所 -->
    </div>

    <div>
        <h3>残りポイント: <span id="remainingPoints">1000</span></h3> <!-- 残りポイント -->
        <h3>残り時間: <span id="timeLeft">15</span>秒</h3> <!-- 残り時間 -->
        <p id="gameOverMessage" style="color: red;"></p> <!-- ゲームオーバーメッセージ -->
    </div>

    <script>
        let selectedPokemonNumber = null;  // 選ばれたポケモンの番号を保持
        let remainingPoints = 1000;  // 初期ポイント
        let timeLimit = 15;  // 制限時間（秒）
        let timer;  // タイマーを格納する変数
        let correctAnswers = 0;  // 正解した問題数をカウント

        // JSONファイルをfetchで読み込む
        function loadPokemonData() {
            return fetch('../js/pokemon_data.json')  // JSONファイルを指定
                .then(response => response.json())  // JSONデータとして処理
                .then(data => {
                    return data;  // データを返す
                })
                .catch(error => {
                    console.error("データの読み込みに失敗しました:", error);
                });
        }

        // タイマーを開始する関数
        function startTimer() {
            let timeLeft = timeLimit;
            document.getElementById('timeLeft').innerText = timeLeft;

            timer = setInterval(function() {
                timeLeft--;
                document.getElementById('timeLeft').innerText = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeOut();  // 時間切れ時の処理
                }
            }, 1000);  // 1秒ごとにカウントダウン
        }

        // 時間切れ時の処理
        function timeOut() {
            const resultMessage = document.getElementById('resultMessage');
            resultMessage.innerText = '時間切れ！';
            resultMessage.style.color = 'red';

            // ゲームオーバー処理を追加
            endGame();
        }

        // ランダムなポケモンを表示する関数
        function displayRandomPokemon(pokemonData) {
            const randomIndex = Math.floor(Math.random() * pokemonData.length);
            const selectedPokemon = pokemonData[randomIndex];

            // 選ばれたポケモンの番号を保持
            selectedPokemonNumber = selectedPokemon['番号'];

            // 名前と画像を表示
            document.getElementById('pokemonName').innerText = selectedPokemon['名前'];
            document.getElementById('pokemonImage').src = selectedPokemon['画像'];

            // 結果メッセージをクリア
            document.getElementById('resultMessage').innerText = '';
            document.getElementById('userInput').value = '';  // 入力欄をリセット

            // タイマーをリセットして開始
            clearInterval(timer);
            startTimer();
        }

        // ユーザーの入力をチェックする関数
        function checkAnswer() {
            clearInterval(timer);  // タイマーを停止
            const userInput = document.getElementById('userInput').value;
            const resultMessage = document.getElementById('resultMessage');

            if (userInput == "") {
                resultMessage.innerText = '番号を入力してください。';
                resultMessage.style.color = 'red';
                startTimer();  // タイマーを再開
                return;
            }

            const inputNumber = parseInt(userInput);
            const difference = Math.abs(inputNumber - selectedPokemonNumber);  // 入力と正解の番号の差

            // ポイントを差し引く
            remainingPoints -= difference;
            if (remainingPoints < 0) remainingPoints = 0;

            // ポイント表示を更新
            document.getElementById('remainingPoints').innerText = remainingPoints;

            // 正解/不正解の判定
            if (inputNumber === selectedPokemonNumber) {
                resultMessage.innerText = '正解！';
                resultMessage.style.color = 'green';
                correctAnswers++;  // 正解数をカウント
            } else {
                resultMessage.innerText = `不正解… ポイントが ${difference} 減少しました。`;
                resultMessage.style.color = 'red';
            }

            // ポイントが0になったらゲームオーバー
            if (remainingPoints <= 0) {
                endGame();
            } else {
                // 次のポケモンに自動で進む（2秒後）
                setTimeout(function() {
                    loadPokemonData().then(pokemonData => {
                        displayRandomPokemon(pokemonData);
                    });
                }, 2000);  // 2秒後に次のポケモンを表示
            }
        }

        // ゲームオーバー処理
        function endGame() {
            clearInterval(timer);  // タイマーをクリア
            document.getElementById('gameOverMessage').innerText = 'ゲームオーバー！';
            document.getElementById('checkAnswer').disabled = true;  // チェックボタンを無効化
            document.getElementById('userInput').disabled = true;  // 入力欄を無効化

            // SweetAlert2で結果を表示
            Swal.fire({
                title: 'ゲームオーバー！',
                text: `あなたは${correctAnswers}問正解しました。`,
                icon: 'info',
                confirmButtonText: 'OK'
            });
        }

        // ページロード時に最初のポケモンを表示
        window.onload = function() {
            loadPokemonData().then(pokemonData => {
                displayRandomPokemon(pokemonData);
            });
        };

        // チェックボタンでユーザーの答えを確認
        document.getElementById('checkAnswer').addEventListener('click', checkAnswer);

        // エンターキーでチェックを実行
        document.getElementById('userInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });
    </script>
</body>
</html>
